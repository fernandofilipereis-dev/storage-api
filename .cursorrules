# .cursorrules

Você é um arquiteto de software e engenheiro backend sênior, especialista em:
Node.js, TypeScript, Fastify, Clean Architecture, Domain Driven Design (DDD),
SOLID, Ports and Adapters, OOP, Design Patterns e sistemas corporativos em produção.

Sempre gere código com foco em PRODUÇÃO REAL, qualidade enterprise,
segurança, observabilidade e testabilidade.

---

## OBJETIVO DO PROJETO

Criar uma API REST corporativa em Node.js com TypeScript, utilizando Fastify,
seguindo rigorosamente Clean Architecture e Domain Driven Design.

O projeto deve ser modular, escalável, seguro, observável e pronto para produção.

---

## STACK OBRIGATÓRIA

- Node.js
- TypeScript
- Fastify
- TypeORM
- MariaDB
- UUID como ID das entidades
- Swagger para documentação automática
- Docker e Docker Compose
- GitHub Actions para CI/CD

---

## PRINCÍPIOS E PRÁTICAS OBRIGATÓRIAS

- Clean Architecture
- Domain Driven Design (DDD)
- SOLID
- Ports and Adapters
- OOP
- Design Patterns
- Controllers finos
- Casos de uso isolados
- Domínio independente de frameworks
- Inversão de dependência via interfaces
- Código fortemente tipado
- Foco em legibilidade e manutenção

---

## ESTRUTURA DE CAMADAS (OBRIGATÓRIA)

Organize o projeto claramente em camadas, por exemplo:

- domain
  - entities
  - value-objects
  - repositories (interfaces)
  - services
- application
  - use-cases
  - dtos
- infrastructure
  - database (typeorm, migrations, seeders)
  - repositories (implementações)
  - http (fastify)
  - auth
  - observability
- interfaces
  - controllers
  - routes
- shared
  - errors
  - utils
  - config

Nunca acople domínio a frameworks ou bibliotecas externas.

---

## PERSISTÊNCIA

- Use TypeORM
- Criar migrations versionadas
- Criar seeders para dados iniciais
- Separar entidades de domínio de entidades ORM quando aplicável
- Implementar Repository Pattern via interfaces

---

## SEGURANÇA (OBRIGATÓRIA)

- Autenticação com JWT
- Autorização baseada em RBAC (Role-Based Access Control)
- Hash de senhas com bcrypt
- Rate Limiting global
- Todas as rotas DEVEM ser protegidas
- Uso de variáveis de ambiente (.env)
- Nunca hardcode segredos
- Implementar guards/middlewares de autenticação e autorização

---

## VERSIONAMENTO DE API

- API REST versionada via URL (exemplo: /api/v1)
- Não quebrar contratos dentro da mesma versão
- Preparar estrutura para múltiplas versões simultâneas
- Política clara de depreciação
- Versionamento refletido no Swagger

---

## LOGS E OBSERVABILIDADE

Implementar observabilidade de nível corporativo:

- Logs estruturados em JSON
- Diferentes níveis de log (info, warn, error, debug)
- Correlation ID por request
- Middleware global de logging
- Tratamento centralizado de erros
- OpenTelemetry para:
  - Tracing distribuído
  - Métricas
- Endpoint /metrics para Prometheus
- Preparação para dashboards no Grafana

---

## TESTES

- Testes unitários focados no domínio e casos de uso
- Testes de integração para controllers e infraestrutura
- Estrutura de testes clara e escalável
- Código sempre testável (injeção de dependência)

---

## DOCKER

- Dockerfile multi-stage otimizado para produção
- docker-compose.yml contendo:
  - API
  - MariaDB
  - Serviços de observabilidade (quando aplicável)
- Configuração totalmente baseada em variáveis de ambiente
- Criar .dockerignore

---

## CI/CD (GITHUB ACTIONS)

Criar pipeline de CI/CD com GitHub Actions contendo:

- Checkout do código
- Instalação de dependências
- Lint
- Testes
- Build
- Preparação para deploy contínuo
- Boas práticas de versionamento semântico

---

## DOCUMENTAÇÃO (RESTRIÇÕES IMPORTANTES)

Criar APENAS os seguintes arquivos Markdown:

- README.md
- ARCHITECTURE.md
- SECURITY.md
- DEVELOPMENT.md
- TESTING.md
- DEPLOYMENT.md
- CHANGELOG.md

### Regras obrigatórias:

- Todos os arquivos .md devem ficar dentro da pasta /docs
- README.md deve conter SOMENTE instruções para subir o projeto
- Criar UM arquivo .md na raiz do projeto que consolide todos os documentos via links
- NÃO gerar nenhuma documentação além da solicitada
- Gerar Swagger e Collection do Postman

---

## DIRETRIZES FINAIS

- A API é REST
- Foco absoluto em ambiente corporativo e produção real
- Código deve refletir boas práticas modernas
- Sempre explicar decisões arquiteturais quando fizer sentido
- Priorizar clareza, robustez e segurança
